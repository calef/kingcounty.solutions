{%- assign primary_image_id = include.image_id -%}
{%- if (primary_image_id == nil or primary_image_id == '') and include.post.images -%}
  {%- assign primary_image_id = include.post.images | first -%}
{%- endif -%}
{%- assign primary_image = nil -%}
{%- if primary_image_id -%}
  {%- assign primary_image = site.images | where: "checksum", primary_image_id | first -%}
{%- endif -%}
{%- assign primary_image_url = nil -%}
{%- assign primary_image_alt = include.post.title -%}
{%- if primary_image -%}
  {%- assign primary_image_url = primary_image.image_url -%}
  {%- if primary_image.title -%}
    {%- assign primary_image_alt = primary_image.title -%}
  {%- endif -%}
{%- endif -%}
<article class="news-item{% if primary_image_url %} news-item--has-image{% endif %}">
  <header>
    <h3>
      <a href="{{ include.post.url | relative_url }}">{{ include.post.title }}</a>
    </h3>
    <p class="news-meta">
      <time datetime="{{ include.post.date | date_to_xmlschema }}">{% include ap-date.html value=include.post.date %}</time>
      {%- assign show_source = include.show_source -%}
      {%- if show_source == nil -%}
        {%- assign show_source = true -%}
      {%- endif -%}
      {%- if show_source != false and show_source != 'false' and show_source != 0 and show_source != '0' -%}
        {%- assign source_text = include.source_text | default: include.post.source | default: include.post.source_url -%}
        {%- if source_text -%}
          â€¢ <span class="news-source">
            {%- assign matching_org = nil -%}
            {%- if include.post.source -%}
              {%- assign matching_org = site.organizations | where: "title", include.post.source | first -%}
            {%- endif -%}
            {%- if matching_org -%}
              <a href="{{ matching_org.url | relative_url }}">{{ include.post.source }}</a>
            {%- elsif include.post.source_url -%}
              <a href="{{ include.post.source_url }}" rel="noopener noreferrer">{{ source_text }}</a>
            {%- else -%}
              {{ source_text }}
            {%- endif -%}
          </span>
        {%- endif -%}
      {%- endif -%}
    </p>
  </header>
  {%- assign news_excerpt = include.excerpt | default: include.post.excerpt -%}
  {%- if news_excerpt -%}
    {%- assign news_excerpt = news_excerpt | strip_html | strip_newlines -%}
  {%- endif -%}
  {%- assign truncated_excerpt = nil -%}
  {%- if news_excerpt -%}
    {%- assign truncated_excerpt = news_excerpt | truncate: 300 -%}
  {%- endif -%}
  {%- if truncated_excerpt -%}
    <div class="news-item-body{% if primary_image_url %} news-item-body--with-image{% endif %}">
      {%- if primary_image_url -%}
        <div class="news-item-thumb">
          <img src="{{ primary_image_url | relative_url }}" alt="{{ primary_image_alt }}" width="100" height="100" loading="lazy" decoding="async">
        </div>
      {%- endif -%}
      <p class="news-excerpt">{{ truncated_excerpt }}</p>
    </div>
  {%- endif -%}
</article>
