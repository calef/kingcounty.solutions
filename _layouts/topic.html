---
layout: default
---

<article class="page topic-page">
  <header class="page-header">
    {% include breadcrumbs.html root_label="Topics" root_url="/topics/" current=page.title %}
  </header>

  {% assign all_topics = site.topics | sort: "title" %}
  {% assign all_orgs = site.organizations | sort: "title" %}
  {% assign topic_orgs = all_orgs | where_exp: "org", "org.topics and org.topics contains page.title" %}
  {% assign topic_org_titles = topic_orgs | map: "title" %}
  {% assign topic_org_roots = "" | split: "" %}
  {% for org in topic_orgs %}
    {% assign parent_name = org.parent_organization | default: "" %}
    {% if parent_name == "" or parent_name == nil %}
      {% assign topic_org_roots = topic_org_roots | push: org %}
    {% elsif topic_org_titles contains parent_name %}
      {% continue %}
    {% else %}
      {% assign topic_org_roots = topic_org_roots | push: org %}
    {% endif %}
  {% endfor %}

  <div class="page-content">
    {% if content %}
      <div class="topic-body">
        {{ content }}
      </div>
    {% endif %}

    {% if topic_orgs and topic_orgs.size > 0 %}
      <section class="topic-organizations">
        <h2>Organizations focused on {{ page.title }}</h2>
        <div class="hierarchy-tree">
          <ul class="hierarchy-tree-list">
            {% for org in topic_org_roots %}
              {% include org-tree.html organization=org organizations=topic_orgs %}
            {% endfor %}
          </ul>
        </div>
      </section>
    {% else %}
      <section class="topic-organizations">
        <h2>Organizations focused on {{ page.title }}</h2>
        <p>No organizations have been linked to this topic yet.</p>
      </section>
    {% endif %}

    {% assign topic_news = site.posts | where_exp: "post", "post.topics and post.topics contains page.title" %}
    {% assign topic_news_total = 0 %}
    {% if topic_news and topic_news.size > 0 %}
      {% assign topic_news = topic_news | sort: "date" | reverse %}
      {% assign topic_news_total = topic_news | size %}
      {% assign topic_news = topic_news | slice: 0, 20 %}
      <section class="topic-news">
        <h2>News related to {{ page.title }}</h2>
        <ul class="topic-news-list">
          {% for post in topic_news %}
            <li class="topic-news-item">
              <h3>
                <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
              </h3>
              <p class="topic-news-meta">
                <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%B %-d, %Y" }}</time>
                {% assign source_text = post.source | default: post.source_url %}
                {% if source_text %}
                  â€¢ <span class="topic-news-source">
                    {% assign matching_org = nil %}
                    {% if post.source %}
                      {% assign matching_org = site.organizations | where: "title", post.source | first %}
                    {% endif %}
                    {% if matching_org %}
                      <a href="{{ matching_org.url | relative_url }}">{{ post.source }}</a>
                    {% elsif post.source_url %}
                      <a href="{{ post.source_url }}" rel="noopener noreferrer">{{ source_text }}</a>
                    {% else %}
                      {{ source_text }}
                    {% endif %}
                  </span>
                {% endif %}
              </p>
              {% assign post_excerpt = post.excerpt | strip_html | strip_newlines %}
              {% if post_excerpt %}
                <p class="topic-news-excerpt">{{ post_excerpt | truncate: 220 }}</p>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        {% if topic_news_total > 20 %}
          <p class="topic-news-more">
            <a href="{{ '/' | relative_url }}">View all news</a>
          </p>
        {% endif %}
      </section>
    {% endif %}
  </div>
</article>
