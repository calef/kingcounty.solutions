---
layout: default
---

<article class="page news-archive">
  <header class="page-header">
    {% assign news_label = page.title | default: "News" %}
    {% include breadcrumbs.html root_label=news_label root_url="/" %}
  </header>

  <div class="page-content">
    {{ content }}
  </div>

  {%- assign pager = pagination | default: paginator -%}
  {%- assign paginated_posts = pager.posts | default: site.posts -%}

  <section class="news-search" aria-labelledby="news-search-label">
    <div class="news-search-header">
      <h2 id="news-search-label">Search all news</h2>
      <p>Instantly filter across every article by title or source.</p>
    </div>
    <div class="news-search-control">
      <input
        type="search"
        id="news-search-input"
        name="news-search-input"
        placeholder="Search news by headline or source"
        autocomplete="off"
        autocapitalize="none"
        spellcheck="false"
        aria-describedby="news-search-status"
      >
      <button type="button" id="news-search-clear" class="news-search-clear" aria-label="Clear search" hidden>&times;</button>
    </div>
    <div class="news-search-results">
      <p class="news-search-status" id="news-search-status" aria-live="polite">
        Type at least 2 characters to search every article.
      </p>
      <ul class="news-search-list" id="news-search-list"></ul>
    </div>
  </section>

  {%- if paginated_posts and paginated_posts.size > 0 -%}
    <ul class="news-archive-list">
      {%- for post in paginated_posts -%}
        <li class="news-archive-item">
          <h2>
            <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          </h2>
          <p class="news-archive-meta">
            <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%B %-d, %Y" }}</time>
            {%- assign source_text = post.source | default: post.source_url -%}
            {%- if source_text -%}
              • <span class="news-archive-source">
                {%- assign matching_org = nil -%}
                {%- if post.source -%}
                  {%- assign matching_org = site.organizations | where: "title", post.source | first -%}
                {%- endif -%}
                {%- if matching_org -%}
                  <a href="{{ matching_org.url | relative_url }}">{{ post.source }}</a>
                {%- elsif post.source_url -%}
                  <a href="{{ post.source_url }}" rel="noopener noreferrer">{{ source_text }}</a>
                {%- else -%}
                  {{ source_text }}
                {%- endif -%}
              </span>
            {%- endif -%}
          </p>
          {%- assign teaser = post.excerpt | strip_html | strip_newlines -%}
          {%- if teaser == "" or teaser == nil -%}
            {%- assign teaser = post.content | strip_html | strip_newlines -%}
          {%- endif -%}
          {%- if teaser -%}
            <p class="news-archive-excerpt">{{ teaser | truncate: 260 }}</p>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>

    {%- if pager -%}
      {%- assign total_pages = pager.total_pages | default: pager.page_count | default: 1 -%}
      {%- if total_pages > 1 -%}
        <nav class="news-pagination" aria-label="News pagination">
          {%- assign previous_path = pager.previous_page_path | default: pager.previous -%}
          {%- assign next_path = pager.next_page_path | default: pager.next -%}
          <div class="news-pagination-links">
            {%- if previous_path -%}
              <a class="news-pagination-link" href="{{ previous_path | relative_url }}">&larr; Newer</a>
            {%- endif -%}

            {%- assign trail = pager.trail -%}
            {%- if trail and trail.pages -%}
              <ul class="news-pagination-trail">
                {%- for trail_page in trail.pages -%}
                  <li>
                    {%- if trail_page.num == pager.page -%}
                      <span class="is-active">{{ trail_page.num }}</span>
                    {%- else -%}
                      <a href="{{ trail_page.path | relative_url }}">{{ trail_page.num }}</a>
                    {%- endif -%}
                  </li>
                {%- endfor -%}
              </ul>
            {%- else -%}
              <span>Page {{ pager.page | default: 1 }} of {{ total_pages }}</span>
            {%- endif -%}

            {%- if next_path -%}
              <a class="news-pagination-link" href="{{ next_path | relative_url }}">Older &rarr;</a>
            {%- endif -%}
          </div>
        </nav>
      {%- endif -%}
    {%- endif -%}
  {%- else -%}
    <p>No news posts yet.</p>
  {%- endif -%}
</article>

<script>
(function() {
  const MIN_QUERY = 2;
  const MAX_RESULTS = 20;
  const data = [
    {%- for post in site.posts -%}
      {%- assign search_excerpt = post.excerpt | strip_html | strip_newlines -%}
      {%- if search_excerpt == "" or search_excerpt == nil -%}
        {%- assign search_excerpt = post.content | strip_html | strip_newlines -%}
      {%- endif -%}
      {%- assign search_excerpt = search_excerpt | truncate: 220 -%}
      {
        "title": {{ post.title | jsonify }},
        "source": {{ post.source | jsonify }},
        "date": "{{ post.date | date: "%B %-d, %Y" }}",
        "date_iso": "{{ post.date | date_to_xmlschema }}",
        "url": {{ post.url | relative_url | jsonify }},
        "excerpt": {{ search_excerpt | jsonify }}
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ];
  const index = data.map(item => {
    const searchText = [item.title, item.source]
      .filter(Boolean)
      .join(' ')
      .toLowerCase();
    return Object.assign({}, item, { searchText });
  });

  const input = document.getElementById('news-search-input');
  if (!input) return;
  const clearBtn = document.getElementById('news-search-clear');
  const status = document.getElementById('news-search-status');
  const list = document.getElementById('news-search-list');

  function updateStatus(message) {
    if (status) status.textContent = message;
  }

  function renderResults(items, total) {
    if (!list) return;
    if (items.length === 0) {
      list.innerHTML = '';
      updateStatus('No matches found.');
      return;
    }
    const limited = items.slice(0, MAX_RESULTS);
    list.innerHTML = limited.map(item => {
      const source = item.source ? `<span class="news-search-source">${item.source}</span>` : '';
      const metaParts = [`<time datetime="${item.date_iso}">${item.date}</time>`];
      if (source) metaParts.push(source);
      const excerpt = item.excerpt ? `<p class="news-search-result-meta">${item.excerpt}</p>` : '';
      return `
        <li>
          <a href="${item.url}">${item.title}</a>
          <span class="news-search-result-meta">${metaParts.join(' • ')}</span>
          ${excerpt}
        </li>
      `;
    }).join('');

    if (total > MAX_RESULTS) {
      updateStatus(`Showing the first ${MAX_RESULTS} of ${total} matches. Refine your search for more precise results.`);
    } else {
      updateStatus(`Found ${total} ${total === 1 ? 'match' : 'matches'}.`);
    }
  }

  function handleSearch() {
    const query = input.value.trim();
    const hasValue = query.length > 0;
    clearBtn.hidden = !hasValue;

    if (query.length < MIN_QUERY) {
      list.innerHTML = '';
      updateStatus('Type at least 2 characters to search every article.');
      return;
    }

    const tokens = query.toLowerCase().split(/\s+/).filter(Boolean);
    const matches = index.filter(item => tokens.every(token => item.searchText.includes(token)));
    renderResults(matches, matches.length);
  }

  input.addEventListener('input', handleSearch);
  input.addEventListener('focus', handleSearch);
  clearBtn.addEventListener('click', () => {
    input.value = '';
    clearBtn.hidden = true;
    list.innerHTML = '';
    updateStatus('Type at least 2 characters to search every article.');
    input.focus();
  });
})();
</script>
