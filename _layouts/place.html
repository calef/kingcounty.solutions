---
layout: default
---

<article class="page place-page">
  <header class="page-header">
    <nav class="breadcrumbs">
      <a href="{{ '/places/' | relative_url }}">Places</a>
      {% include hierarchy-breadcrumbs.html item=page collection='places' parent_attr='parent_place' %}
      <span>›</span>
      <span>{{ page.title }}</span>
    </nav>
    <h1 class="page-title">{{ page.title }}</h1>
    {% if page.type %}
      <p class="place-type">{{ page.type }}</p>
    {% endif %}
  </header>

  <div class="page-content">
    {% if page.zip_codes %}
      <p class="place-detail"><strong>ZIP Codes:</strong> {{ page.zip_codes | join: ', ' }}</p>
    {% endif %}

    {% assign all_places = site.places | sort: "title" %}
    {% assign child_places = all_places | where: "parent_place", page.title %}
    {% assign all_orgs = site.organizations | sort: "title" %}

    {% assign relevant_places = "" | split: "" %}
    {% assign relevant_places = relevant_places | push: page.title %}
    {% assign current_parent = page.parent_place %}
    {% for i in (0..20) %}
      {% if current_parent %}
        {% unless relevant_places contains current_parent %}
          {% assign relevant_places = relevant_places | push: current_parent %}
        {% endunless %}
        {% assign parent_doc = all_places | where: "title", current_parent | first %}
        {% if parent_doc and parent_doc.parent_place %}
          {% assign current_parent = parent_doc.parent_place %}
        {% else %}
          {% assign current_parent = nil %}
        {% endif %}
      {% else %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% assign relevant_org_titles = "" | split: "" %}
    {% for place_title in relevant_places %}
      {% assign matched_orgs = all_orgs | where_exp: "org", "org.jurisdictions and org.jurisdictions contains place_title" %}
      {% for org in matched_orgs %}
        {% unless relevant_org_titles contains org.title %}
          {% assign relevant_org_titles = relevant_org_titles | push: org.title %}
        {% endunless %}
      {% endfor %}
    {% endfor %}

    {% assign place_news = site.posts | where_exp: "post", "relevant_org_titles contains post.source" %}
    {% assign place_news_total = 0 %}
    {% if place_news and place_news.size > 0 %}
      {% assign place_news = place_news | sort: "date" | reverse %}
      {% assign place_news_total = place_news | size %}
      {% assign place_news = place_news | slice: 0, 20 %}
    {% endif %}

    {% if content %}
      {{ content }}
    {% endif %}

    {% if place_news and place_news.size > 0 %}
      <section class="place-news">
        <h2>News related to {{ page.title }}</h2>
        <ul class="place-news-list">
          {% for post in place_news %}
            <li class="place-news-item">
              <h3>
                <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
              </h3>
              <p class="place-news-meta">
                <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%B %-d, %Y" }}</time>
                {% assign source_text = post.source | default: post.source_url %}
                {% if source_text %}
                  • <span class="place-news-source">
                    {% assign matching_org = nil %}
                    {% if post.source %}
                      {% assign matching_org = site.organizations | where: "title", post.source | first %}
                    {% endif %}
                    {% if matching_org %}
                      <a href="{{ matching_org.url | relative_url }}">{{ post.source }}</a>
                    {% elsif post.source_url %}
                      <a href="{{ post.source_url }}" rel="noopener noreferrer">{{ source_text }}</a>
                    {% else %}
                      {{ source_text }}
                    {% endif %}
                  </span>
                {% endif %}
              </p>
              {% assign post_excerpt = post.excerpt | strip_html | strip_newlines %}
              {% if post_excerpt %}
                <p class="place-news-excerpt">{{ post_excerpt | truncate: 220 }}</p>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        {% if place_news_total > 20 %}
          <p class="place-news-more">
            <a href="{{ '/' | relative_url }}">View all news</a>
          </p>
        {% endif %}
      </section>
    {% endif %}

    {% if child_places and child_places.size > 0 %}
      <section class="place-children">
        <h2>Places within {{ page.title }}</h2>
        <div class="place-tree">
          <ul class="places-tree-list">
            {% for child in child_places %}
              {% include place-tree.html place=child places=all_places %}
            {% endfor %}
          </ul>
        </div>
      </section>
    {% endif %}
  </div>
</article>

<style>
.breadcrumbs {
  font-size: 0.9rem;
  color: #666;
}
.breadcrumbs a {
  text-decoration: none;
  color: inherit;
}
.breadcrumbs span {
  margin: 0 0.4rem;
}
.place-type {
  margin-top: -0.5rem;
  color: #666;
}
.place-detail {
  margin: 0.25rem 0;
  color: #444;
}
.place-tree {
  margin-top: 0.75rem;
}
.place-tree .places-tree-list {
  list-style: none;
  margin: 0;
  padding-left: 1rem;
}
.place-tree .places-tree-list > li {
  margin-bottom: 0.35rem;
}
.place-tree .places-tree-item > a {
  font-weight: 600;
  text-decoration: none;
}
.place-tree .places-tree-item > a:hover {
  text-decoration: underline;
}
.place-tree .places-tree-list ul {
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
  padding-left: 1rem;
  border-left: 1px solid #eee;
}
.place-news {
  margin-top: 1.5rem;
}
.place-news h2 {
  margin-bottom: 0.5rem;
}
.place-news-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.place-news-item {
  margin-bottom: 0.35rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid #eee;
}
.place-news-item:last-child {
  border-bottom: none;
}
.place-news h3 {
  margin: 0 0 0.25rem;
}
.place-news a {
  font-weight: 600;
  text-decoration: none;
}
.place-news a:hover {
  text-decoration: underline;
}
.place-news-meta {
  margin: 0;
  color: #666;
  font-size: 0.9rem;
}
.place-news-meta time {
  font-weight: 500;
}
.place-news-source a {
  color: inherit;
}
.place-news-excerpt {
  margin: 0.1rem 0 0.5rem;
  color: #444;
  font-size: 0.95em;
}
.place-news-more {
  margin-top: 0.5rem;
}
.place-news-more a {
  font-weight: 600;
  text-decoration: none;
}
.place-news-more a:hover {
  text-decoration: underline;
}
</style>
